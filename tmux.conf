# Tmux configuration file
#
# Sources:
#   http://blog.hawkhost.com/2009/07/02/tmux--the-terminal-multiplexer-part-2/
#   https://upcase.com/tmux


# Tmux in a few words
# -------------------
# Tmux Server
#   +-- Session
#         +-- Window
#               +---- Pane
#
# A tmux server hosts muliple sessions.
# Multiple tmux servers can run at the same time.
#    tmux ls  # list existing sessions in a tmux server
#    tmux attach -t SESSION_NAME  # Open the session SESSION_NAME
#
# A tmux session is a logical grouping of windows.
# Multiple sessions can run at the same time.
# Selecting a session gives you acces to the windows it s composed of.
#
# A window looks like a tab you can select.
# Once you choose a window, the panes it is composed of become visible.
#
# A pane is rectangular area within a windoww within which you interact 
# as you do in a regular terminal.

# Syntax
# ------
# bind-key is aliased bind
# unbind-key is alised unbind
# set-window is aliased set-w
# set-option is aliased set

# ~~~~~~~~~~~~~~~
#   Key Bindings
# ~~~~~~~~~~~~~~~
# Action Key binding: Use C-a instead of C-b as a prefix for any command
# To send <Control>-a to an application running within tmux simply by press CTRL-a twice.
set -g prefix C-a
bind-key C-a send-prefix

# Release the defaut prefix  <Control>b  so that it can be used for something else
unbind-key C-b

# use emacs key bindings
set-w -g mode-keys emacs

# <Control>r  reloads tmux config file
unbind-key r
bind-key r source-file ~/.tmux.conf \; display "~/.tmux.conf reloaded!"

# <Control>s  forward-incremental-history-search
bind-key C-s send-prefix -2

# <Prefix>z focus on a the current pane (zomm)


# ~~~~~~~~~~~~~~~~~~~
# Create Window
# ~~~~~~~~~~~~~~~~~~~
# <Prefix>c  create a new window
bind c new-window -c "#{pane_current_path}"

# Keep the window name fixed
set-window-option -g automatic-rename off 
set-option -g allow-rename off

# ~~~~~~~~~~~~~~~~~~~
# Create Panes
# ~~~~~~~~~~~~~~~~~~~
# New panes are created in the directory of the current pane 
# <Prefix>- split window vertically
bind-key | split-window -h -c '#{pane_current_path}'

# <Prefix>| split window horizontally
bind-key - split-window -v -c '#{pane_current_path}'

# <Prefix>b break the current pane into a new window
bind-key b break-pane -d

# ~~~~~~~~~~~~~~~~~~~
# Resize Panes
# ~~~~~~~~~~~~~~~~~~~
# Fine adjustment (1 or 2 cursor cells per bump)
bind -n S-Left  resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Down  resize-pane -D 1
bind -n S-Up    resize-pane -U 1

# Resize current pane (5 or 10 cursor cells per bump)
bind -n C-Left  resize-pane -L 10
bind -n C-Right resize-pane -R 10
bind -n C-Down  resize-pane -D 5
bind -n C-Up    resize-pane -U 5

#~~~~~~~~~~~~~~
# Window and Pane Numbering 
#~~~~~~~~~~~~~~
set -g  base-index      1 # Window numbering start at 1 (instead of 0 by default).
setw -g pane-base-index 1 # Pane numvering start at 1
set -g renumber-windows on # Renumber windows as they are created and destroyed 
                           #   to keep the window numbers consistent with the count.

# ~~~~~~~~~~~~~
#   Colours
# ~~~~~~~~~~~~~

# Colours: Inactive Window: cyan 
setw -g window-status-fg cyan
setw -g window-status-bg default
setw -g window-status-attr dim

# Colours: Active Window: red
setw -g window-status-current-fg white
setw -g window-status-current-bg red
setw -g window-status-current-attr bright

# Colours: Pane Divider
set -g pane-border-fg green
set -g pane-border-bg black
set -g pane-active-border-fg white
set -g pane-active-border-bg yellow

# Colours: Command Line: White text on a black background
set -g message-fg white
set -g message-bg black
set -g message-attr bright

# Highlight active window 
set-window-option -g window-status-current-bg red


# ~~~~~~~~~~~~~
#   Mouse
# ~~~~~~~~~~~~~
# Enable mouse scroll when in scroll mode (ActionKey + [ )
# Click on a pane to give it the focus
# Use Shift + mouse to select/paste text
if-shell "[[ $(tmux -V) == *2.1 ]]" "set -g mouse on"
if-shell "[[ $(tmux -V) == *2.0 || $(tmux -V) == *1.* ]]" \
    'setw -g mode-mouse on;  \
    set -g mouse-select-pane on; \
    set -g mouse-resize-pane on; \
    set -g mouse-select-window on'


# scroll with the mouse wheels
# 
bind-key -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind-key -n WheelDownPane select-pane -t= \; send-keys -M


#~~~~~~~~~~~~~~
#  Terminal
#~~~~~~~~~~~~~~
# Uncomment in case arrows do not work in vi, when in 256 colors
#set -g default-terminal "xterm"
set -g default-terminal "screen-256color"
set -g history-limit 20000


#~~~~~~~~~~~~~~
#  Status Bar
#~~~~~~~~~~~~~~
# Colours: Status Bar: Light gray
set -g status-bg '#666666'
set -g status-fg '#aaaaaa'

# status-left command tells tmux to display the following text to the left of the terminal. 
# The [fg=green]#H portion tells tmux to display the hostname of localhost and make it green.
# The #H portion is part of tmux variable expansion 
set -g status-left '#[fg=green]#H'

set -g status-right '#[fg=yellow]#(uptime | cut -d "," -f 3-)  '
set -g status-right-length 50

# Refresh the status bar every minute
set -g status-interval 60


#~~~~~~~~~~~~~~
# Window notifications
#~~~~~~~~~~~~~~
# tmux notify you in the status area when a window has activity
#
setw -g monitor-activity on
set -g visual-activity on


#~~~~~~~~~~~~~~
# Center the window list
#~~~~~~~~~~~~~~
set -g status-justify centre



#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Copy/paste from tmux (MacOS specific)
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#set-option -g default-command 'reattach-to-user-namespace -l "$SHELL"'
